<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dasbor Pembukuan Kost</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- 
        Chosen Palette: Calm Harmony (Warm Neutrals)
        Application Structure Plan: Desain aplikasi ini menggunakan pendekatan dasbor satu halaman. Struktur ini dipilih karena memungkinkan pengguna melihat semua informasi penting (KPI, grafik, dan daftar transaksi) dalam satu layar tanpa perlu berpindah halaman, yang mana lebih intuitif daripada format multi-sheet pada Excel. Pengguna dapat dengan mudah mengubah periode waktu (bulan/tahunan) melalui filter di bagian atas, dan semua komponen di dasbor akan diperbarui secara dinamis. Alur ini memusatkan kontrol dan memberikan umpan balik visual instan, mempermudah proses analisis dan pencatatan data keuangan.
        Visualization & Content Choices:
        - Ringkasan KPI (Inform): Menggunakan kartu (card) HTML/Tailwind untuk menampilkan metrik utama seperti Laba Bersih dan Saldo Kas. Interaksinya adalah pembaruan nilai secara dinamis. Ini memberikan gambaran cepat kondisi keuangan.
        - Grafik Batang Pemasukan vs Pengeluaran (Compare): Menggunakan Chart.js (Canvas) untuk membandingkan total pemasukan dan pengeluaran setiap bulan. Ini efektif untuk melihat performa bulanan secara visual.
        - Grafik Garis Tren Laba (Change): Menggunakan Chart.js (Canvas) untuk menunjukkan tren laba bersih sepanjang tahun, membantu identifikasi periode naik/turun.
        - Tabel Transaksi (Organize): Menggunakan tabel HTML dinamis yang bisa difilter berdasarkan bulan. Ini berguna untuk melihat detail setiap transaksi yang membentuk ringkasan.
        - Form Input (Data Entry): Menggunakan modal HTML/JS untuk memasukkan data baru tanpa meninggalkan halaman utama.
        CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f7f4; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 300px; max-height: 400px; }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        /* Style for the dropdown menu can be kept minimal as Tailwind handles most of it */
    </style>
</head>
<body class="text-gray-800">

    <div id="app" class="container mx-auto p-4 md:p-6">

        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-700">Pembukuan Kost Ananda</h1>
            <p class="text-gray-500 mt-1">WELCOME</p>
        </header>

        <main>
            <!-- Filter Section -->
            <div class="mb-6 bg-white p-4 rounded-xl shadow-sm flex flex-col items-center">
                <label for="period-selector-btn" class="text-sm font-semibold text-gray-600 mb-2">Tampilkan Data Untuk Periode:</label>
                <div class="relative inline-block text-left w-full md:w-64">
                    <div>
                        <button type="button" id="period-selector-btn" class="inline-flex justify-between w-full rounded-lg border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-blue-500" aria-haspopup="true" aria-expanded="true">
                            <span id="selected-period-text">Pilih Periode</span>
                            <svg class="-mr-1 ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                    <div id="period-dropdown" class="origin-top-right absolute right-0 mt-2 w-full rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10 hidden">
                        <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
                            <!-- Dropdown items will be generated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Cards -->
            <section id="summary-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6">
                <div class="bg-white p-5 rounded-xl shadow-sm flex flex-col justify-between">
                    <h3 class="text-sm font-semibold text-gray-500">Total Pemasukan</h3>
                    <p id="total-income" class="text-2xl lg:text-3xl font-bold text-green-600">Rp 0</p>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-sm flex flex-col justify-between">
                    <h3 class="text-sm font-semibold text-gray-500">Total Pengeluaran</h3>
                    <p id="total-expense" class="text-2xl lg:text-3xl font-bold text-red-600">Rp 0</p>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-sm flex flex-col justify-between">
                    <h3 class="text-sm font-semibold text-gray-500">Laba / Rugi Bersih</h3>
                    <p id="net-profit" class="text-2xl lg:text-3xl font-bold text-blue-600">Rp 0</p>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-sm flex flex-col justify-between">
                    <h3 class="text-sm font-semibold text-gray-500">Saldo Kas (Total)</h3>
                    <p id="cash-balance" class="text-2xl lg:text-3xl font-bold text-gray-700">Rp 0</p>
                </div>
            </section>
            
            <!-- Charts Section -->
            <section id="charts" class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 mb-6">
                <div class="bg-white p-4 rounded-xl shadow-sm">
                    <h3 class="text-lg font-semibold text-center mb-2">Pemasukan vs Pengeluaran Bulanan</h3>
                     <p class="text-xs text-gray-500 text-center mb-4">Grafik ini membandingkan total pemasukan dan pengeluaran yang terjadi setiap bulan sepanjang tahun. Gunakan ini untuk menganalisis performa bulanan.</p>
                    <div class="chart-container">
                        <canvas id="incomeExpenseChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm">
                    <h3 class="text-lg font-semibold text-center mb-2">Tren Laba Bersih Tahunan</h3>
                    <p class="text-xs text-gray-500 text-center mb-4">Grafik ini menunjukkan pergerakan laba bersih Anda dari bulan ke bulan. Ini membantu Anda melihat tren pertumbuhan atau penurunan bisnis.</p>
                    <div class="chart-container">
                        <canvas id="netProfitTrendChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Transactions Section -->
            <section id="transactions" class="bg-white p-4 md:p-6 rounded-xl shadow-sm">
                <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold mb-2 md:mb-0">Daftar Transaksi</h3>
                    <button id="add-transaction-btn" class="w-full md:w-auto bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                        + Tambah Transaksi
                    </button>
                </div>
                 <p class="text-sm text-gray-600 mb-4">Di bawah ini adalah rincian semua transaksi untuk periode yang Anda pilih. Setiap kali Anda menambahkan data baru, semua ringkasan dan grafik di atas akan diperbarui secara otomatis.</p>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm text-left">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-3">Tanggal</th>
                                <th class="p-3">Keterangan</th>
                                <th class="p-3 text-right">Jumlah</th>
                                <th class="p-3 text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="transaction-table-body">
                            <!-- Rows will be generated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal for Adding Transaction -->
    <div id="transaction-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex justify-center items-center">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md mx-4">
            <h3 class="text-xl font-bold mb-4">Tambah Transaksi Baru</h3>
            <form id="transaction-form">
                <div class="mb-4">
                    <label for="date" class="block text-sm font-medium text-gray-700">Tanggal</label>
                    <input type="date" id="date" name="date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div class="mb-4">
                    <label for="description" class="block text-sm font-medium text-gray-700">Keterangan</label>
                    <input type="text" id="description" name="description" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Contoh: Gaji bulanan" required>
                </div>
                <div class="mb-4">
                    <label for="type" class="block text-sm font-medium text-gray-700">Tipe</label>
                    <select id="type" name="type" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="income">Pemasukan</option>
                        <option value="expense">Pengeluaran</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="amount" class="block text-sm font-medium text-gray-700">Jumlah (Rp)</label>
                    <input type="number" id="amount" name="amount" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="5000000" required>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancel-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300">Batal</button>
                    <button type="submit" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const STORAGE_KEY = 'personalFinanceData';

            const state = {
                transactions: [],
                currentPeriod: 'Tahun',
                charts: {},
            };
            
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];

            const saveData = () => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state.transactions));
            };

            const loadData = () => {
                const data = localStorage.getItem(STORAGE_KEY);
                if (data) {
                    return JSON.parse(data);
                } else {
                    return [];
                }
            };

            const formatCurrency = (value) => {
                return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(value);
            };

            const setupPeriodSelector = () => {
                const btn = document.getElementById('period-selector-btn');
                const dropdown = document.getElementById('period-dropdown');
                const dropdownContent = dropdown.querySelector('.py-1');
                const selectedPeriodText = document.getElementById('selected-period-text');

                dropdownContent.innerHTML = '';
                const allPeriods = ['Tahun', ...months];
                allPeriods.forEach(period => {
                    const a = document.createElement('a');
                    a.href = '#';
                    a.textContent = period;
                    a.dataset.period = period;
                    a.className = 'block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900';
                    a.addEventListener('click', (e) => {
                        e.preventDefault();
                        state.currentPeriod = period;
                        selectedPeriodText.textContent = period;
                        dropdown.classList.add('hidden');
                        renderDashboard();
                    });
                    dropdownContent.appendChild(a);
                });

                btn.addEventListener('click', () => {
                    dropdown.classList.toggle('hidden');
                });

                window.addEventListener('click', (e) => {
                    if (!btn.contains(e.target) && !dropdown.contains(e.target)) {
                        dropdown.classList.add('hidden');
                    }
                });
                
                selectedPeriodText.textContent = state.currentPeriod;
            };

            const renderSummaryCards = () => {
                const monthIndex = months.indexOf(state.currentPeriod);
                
                const filteredTransactions = state.transactions.filter(t => {
                    if (state.currentPeriod === 'Tahun') return true;
                    return new Date(t.date).getMonth() === monthIndex;
                });
                
                const totalIncome = filteredTransactions.reduce((sum, t) => t.type === 'income' ? sum + t.amount : sum, 0);
                const totalExpense = filteredTransactions.reduce((sum, t) => t.type === 'expense' ? sum + t.amount : sum, 0);
                const netProfit = totalIncome - totalExpense;

                const overallIncome = state.transactions.reduce((sum, t) => t.type === 'income' ? sum + t.amount : sum, 0);
                const overallExpense = state.transactions.reduce((sum, t) => t.type === 'expense' ? sum + t.amount : sum, 0);
                const cashBalance = overallIncome - overallExpense;

                document.getElementById('total-income').textContent = formatCurrency(totalIncome);
                document.getElementById('total-expense').textContent = formatCurrency(totalExpense);
                document.getElementById('net-profit').textContent = formatCurrency(netProfit);
                document.getElementById('cash-balance').textContent = formatCurrency(cashBalance);
            };

            const renderTransactionTable = () => {
                const tbody = document.getElementById('transaction-table-body');
                tbody.innerHTML = '';
                const monthIndex = months.indexOf(state.currentPeriod);

                const filteredTransactions = state.transactions
                    .filter(t => {
                        if (state.currentPeriod === 'Tahun') return true;
                        return new Date(t.date).getMonth() === monthIndex;
                    })
                    .sort((a, b) => new Date(b.date) - new Date(a.date));

                if (filteredTransactions.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="4" class="text-center p-4 text-gray-500">Belum ada transaksi. Silakan tambah data baru.</td></tr>`;
                    return;
                }
                
                filteredTransactions.forEach(t => {
                    const row = document.createElement('tr');
                    row.className = 'border-b hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="p-3">${new Date(t.date).toLocaleDateString('id-ID')}</td>
                        <td class="p-3">${t.description}</td>
                        <td class="p-3 text-right font-medium ${t.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                            ${t.type === 'income' ? '+' : '-'} ${formatCurrency(t.amount)}
                        </td>
                        <td class="p-3 text-center">
                            <button data-id="${t.id}" class="delete-btn text-gray-400 hover:text-red-600">🗑️</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });

                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const idToDelete = parseInt(e.currentTarget.dataset.id, 10);
                        state.transactions = state.transactions.filter(t => t.id !== idToDelete);
                        saveData();
                        renderDashboard();
                    });
                });
            };

            const renderCharts = () => {
                const monthlyData = months.map((month, index) => {
                    const income = state.transactions
                        .filter(t => t.type === 'income' && new Date(t.date).getMonth() === index)
                        .reduce((sum, t) => sum + t.amount, 0);
                    const expense = state.transactions
                        .filter(t => t.type === 'expense' && new Date(t.date).getMonth() === index)
                        .reduce((sum, t) => sum + t.amount, 0);
                    return { month, income, expense, net: income - expense };
                });

                const incomeExpenseCtx = document.getElementById('incomeExpenseChart').getContext('2d');
                if(state.charts.incomeExpense) state.charts.incomeExpense.destroy();
                state.charts.incomeExpense = new Chart(incomeExpenseCtx, {
                    type: 'bar',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Pemasukan',
                                data: monthlyData.map(d => d.income),
                                backgroundColor: 'rgba(74, 222, 128, 0.6)',
                                borderColor: 'rgba(34, 197, 94, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Pengeluaran',
                                data: monthlyData.map(d => d.expense),
                                backgroundColor: 'rgba(248, 113, 113, 0.6)',
                                borderColor: 'rgba(239, 68, 68, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { y: { beginAtZero: true } }
                    }
                });

                const netProfitTrendCtx = document.getElementById('netProfitTrendChart').getContext('2d');
                if(state.charts.netProfitTrend) state.charts.netProfitTrend.destroy();
                state.charts.netProfitTrend = new Chart(netProfitTrendCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'Laba Bersih',
                            data: monthlyData.map(d => d.net),
                            fill: false,
                            borderColor: 'rgb(59, 130, 246)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { y: { beginAtZero: true } }
                    }
                });
            };

            const setupModal = () => {
                const modal = document.getElementById('transaction-modal');
                const openBtn = document.getElementById('add-transaction-btn');
                const cancelBtn = document.getElementById('cancel-btn');
                const form = document.getElementById('transaction-form');

                openBtn.addEventListener('click', () => modal.classList.remove('hidden'));
                cancelBtn.addEventListener('click', () => modal.classList.add('hidden'));
                
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const newTransaction = {
                        id: Date.now(),
                        date: form.date.value,
                        description: form.description.value,
                        type: form.type.value,
                        amount: parseInt(form.amount.value, 10),
                    };
                    state.transactions.push(newTransaction);
                    saveData();
                    form.reset();
                    document.getElementById('date').valueAsDate = new Date();
                    modal.classList.add('hidden');
                    renderDashboard();
                });
            };

            const renderDashboard = () => {
                renderSummaryCards();
                renderTransactionTable();
                renderCharts();
            };

            const init = () => {
                state.transactions = loadData();
                const currentMonthName = months[new Date().getMonth()];
                state.currentPeriod = currentMonthName;
                document.getElementById('date').valueAsDate = new Date();
                setupModal();
                setupPeriodSelector(); 
                renderDashboard();
            };

            init();
        });
    </script>
</body>
</html>
